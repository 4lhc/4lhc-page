<!DOCTYPE html> <html lang="en"> <head> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>Create a ROS melodic container with singularity | Sreejith Sasidharan</title> <meta name="author" content="Sreejith Sasidharan"/> <meta name="description" content="Creating a ROS melodic container with singularity 3.5"/> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"/> <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha256-DF7Zhf293AJxJNTmh5zhoYYIMs2oXitRfBjY+9L//AY=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"/> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css" integrity="sha256-i1+4qU2G2860dGGIOJscdC30s9beBXjFfzjWLjBRsBg=" crossorigin="anonymous"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/github.css" media="none" id="highlight_theme_light"/> <link rel="shortcut icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸ‡¸</text></svg>"> <link rel="stylesheet" href="/assets/css/main.css"> <link rel="canonical" href="https://sreejiths.xyz/blog/2020/creating-ROS-melodic-container-with-singularity-3.5/"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/native.css" media="none" id="highlight_theme_dark"/> <script src="/assets/js/theme.js"></script> <script src="/assets/js/dark_mode.js"></script> </head> <body class="fixed-top-nav sticky-bottom-footer"> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="https://sreejiths.xyz/"><span class="font-weight-bold">Sreejith</span> Sasidharan</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about</a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">blog<span class="sr-only">(current)</span></a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">publications</a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fas fa-moon"></i> <i class="fas fa-sun"></i> </button> </li> </ul> </div> </div> </nav> </header> <div class="container mt-5"> <div class="post"> <header class="post-header"> <h1 class="post-title">Create a ROS melodic container with singularity</h1> <p class="post-meta">June 1, 2020</p> <p class="post-tags"> <a href="/blog/2020"> <i class="fas fa-calendar fa-sm"></i> 2020 </a> Â  Â· Â  <a href="/blog/tag/singularity"> <i class="fas fa-hashtag fa-sm"></i> singularity</a> Â  <a href="/blog/tag/containers"> <i class="fas fa-hashtag fa-sm"></i> containers</a> Â  <a href="/blog/tag/ros"> <i class="fas fa-hashtag fa-sm"></i> ros</a> Â  <a href="/blog/tag/docker"> <i class="fas fa-hashtag fa-sm"></i> docker</a> Â  Â  Â· Â  <a href="/blog/category/ros"> <i class="fas fa-tag fa-sm"></i> ros</a> Â  </p> </header> <article class="post-content"> <p>Singularity can create portable and reproducible ROS environments. Moreover, we can run ROS environments that are unsupported for our distros without having to mess with virtual machines. It is quite easy to set up a singularity container for ROS melodic. We will be using the osrf docker image from <a href="https://hub.docker.com/_/ros" target="_blank" rel="noopener noreferrer">Docker Hub</a>. Before we begin, follow the instructions <a href="">here</a> to install singularity if you havenâ€™t.</p> <h3 id="creating-a-sandbox">Creating a sandbox</h3> <p>It is recommended to run the command below with root permissions.</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>singularity build <span class="nt">--sandbox</span> melodic/ docker://osrf/ros:melodic-desktop-full
</code></pre></div></div> <p>This will create a directory named <code class="language-plaintext highlighter-rouge">melodic</code> inside the current working directory. Once the sandbox is built, we can test it by running <code class="language-plaintext highlighter-rouge">roscore</code>.</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>singularity <span class="nb">exec</span> <span class="nt">-p</span> melodic/  bash <span class="nt">-c</span> <span class="s1">'/ros_entrypoint.sh roscore'</span>
</code></pre></div></div> <p>Where <code class="language-plaintext highlighter-rouge">ros_entrypoint.sh</code> is a bash script inside the <code class="language-plaintext highlighter-rouge">melodic/</code> sandbox that sources <code class="language-plaintext highlighter-rouge">setup.bash</code> for us.</p> <h3 id="update-and-modification">Update and modification</h3> <p>Letâ€™s now proceed by updating the packages (you can also install packages that you need). For this we will use the <code class="language-plaintext highlighter-rouge">shell</code> command. Note, that the <code class="language-plaintext highlighter-rouge">--writable</code> option is necessary to mount the container as read-write.</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>singularity shell <span class="nt">--writable</span> melodic/
</code></pre></div></div> <p>Once we are inside the container shell, we can run <code class="language-plaintext highlighter-rouge">apt update</code> and install our packages. We can also add the update the <code class="language-plaintext highlighter-rouge">/root/.bashrc</code> to our taste. Or, ditch bash altogether and install <code class="language-plaintext highlighter-rouge">zsh</code>.</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> apt update
<span class="o">&gt;</span> <span class="nb">mkdir</span> <span class="nt">-p</span> /root/Projects <span class="c">#if you want to create extra directories</span>
</code></pre></div></div> <h3 id="binding-filesystems">Binding filesystems</h3> <p>By default, singularity will mount the current working directory inside the container, if the directory exists inside. You can use the <code class="language-plaintext highlighter-rouge">--bind</code> option to mount host filesystems to directories inside the container. For example, the following command will start the shell and mount my host systemâ€™s <code class="language-plaintext highlighter-rouge">/dev/sda5</code> to <code class="language-plaintext highlighter-rouge">/root/Projects</code>.</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>singularity shell <span class="nt">--bind</span> /dev/sda5:/root/Projects <span class="nt">--bind</span> /run <span class="nt">--writable</span> melodic/
</code></pre></div></div> <p>In order to run gui applications, use <code class="language-plaintext highlighter-rouge">--bind /run</code>.</p> <h3 id="convert-container-format">Convert container format</h3> <p>Finally, we can create <code class="language-plaintext highlighter-rouge">img</code> file from the <code class="language-plaintext highlighter-rouge">sandbox</code> by running the following command.</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>singularity build melodic.img melodic/
</code></pre></div></div> <h3 id="building-from-recipe-files">Building from recipe files</h3> <p>The steps mentioned above can be build easily with a recipe file too.</p> <figure class="highlight"><pre><code class="language-docker" data-lang="docker"><table class="rouge-table"><tbody><tr>
<td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre></td> <td class="code"><pre><span class="c">#melodic-husky.def</span>
Bootstrap: docker
<span class="k">From</span><span class="s">: osrf/ros:melodic-desktop-full-bionic</span>

%help
    Singularity container with ROS melodic with husky

%labels
    Author sj@email.org
    

%post
    apt -y update
    apt -y install ros-melodic-husky-navigation \
                   ros-melodic-husky-gazebo \
                   ros-melodic-husky-viz
    bash -c "source /opt/ros/melodic/setup.bash"
</pre></td> </tr></tbody></table></code></pre></figure> <p>Build the container with the following command</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>singularity build melodic-husky.sif melodic-husky.def
</code></pre></div></div> <h3 id="reference">Reference</h3> <p>[1] <a href="https://stackoverflow.com/questions/55645332/how-to-use-change-directory-cd-and-source-commands-in-a-singularity-recipe" target="_blank" rel="noopener noreferrer">https://stackoverflow.com/questions/55645332/how-to-use-change-directory-cd-and-source-commands-in-a-singularity-recipe</a></p> <p>[2] <a href="https://sylabs.io/guides/3.1/user-guide/definition_files.html" target="_blank" rel="noopener noreferrer">https://sylabs.io/guides/3.1/user-guide/definition_files.html</a></p> </article><div id="disqus_thread"></div> <script type="text/javascript">var disqus_shortname="sreejiths-xyz",disqus_identifier="/blog/2020/creating-ROS-melodic-container-with-singularity-3.5",disqus_title="Create a ROS melodic container with singularity";!function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="//"+disqus_shortname+".disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)}();</script> <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript" target="_blank" rel="noopener noreferrer">comments powered by Disqus.</a> </noscript> </div> </div> <footer class="sticky-bottom mt-5"> <div class="container"> Â© Copyright 2022 Sreejith Sasidharan. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="noopener noreferrer">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" target="_blank" rel="noopener noreferrer">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="noopener noreferrer">GitHub Pages</a>. Photos from <a href="https://unsplash.com" target="_blank" rel="noopener noreferrer">Unsplash</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script async src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.2/dist/umd/popper.min.js" integrity="sha256-l/1pMF/+J4TThfgARS6KwWrk/egwuVvhRzfLAMQ6Ds4=" crossorigin="anonymous"></script> <script async src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.min.js" integrity="sha256-SyTu6CwrfOhaznYZPoolVw2rxoY7lKYKQvqbtqN93HI=" crossorigin="anonymous"></script> <script async src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.6/dist/medium-zoom.min.js" integrity="sha256-EdPgYcPk/IIrw7FYeuJQexva49pVRZNmt3LculEr7zM=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js"></script> <script defer src="/assets/js/common.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> </body> </html>